<!DOCTYPE html>
<meta charset="utf-8">
<title>Libraries and the COVID-19 crisis</title>
<script src="https://d3js.org/d3.v3.min.js"></script>
<style>

.axis text {
  font: 10px sans-serif;
}

.axis path, .axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

#chart {
  width: 100%;
  height: 100%;
  position: absolute;
}

#metadata {
  position: fixed;
  left: 10px;
  top: 10px;
  border: 1px solid black;
  padding: 5px;
}
</style>
<body>
<div id="metadata"></div>
<svg id="chart"></svg>
<script>

var data = {"profile": {"count": 153655, "retweetcount": 119810, "geocount": 69, "earliest": "2020-03-02 07:52:51 MST", "latest": "2020-04-02 12:00:54 MDT", "usercount": 98948, "opts": {"timezone": "America/Edmonton", "aggregate": true, "output": "html", "template": "timebar.html", "intervalStr": "3H", "interval": 10800000, "format": "%Y-%m-%d %H", "intervalLabel": "3 hours"}, "args": ["projects/covidlibraries"], "metadatafile": "projects/covidlibraries/metadata.json"}, "values": [{"name": "2020-03-02 06", "value": 12}, {"name": "2020-03-02 09", "value": 34}, {"name": "2020-03-02 12", "value": 24}, {"name": "2020-03-02 15", "value": 30}, {"name": "2020-03-02 18", "value": 25}, {"name": "2020-03-02 21", "value": 11}, {"name": "2020-03-03 00", "value": 8}, {"name": "2020-03-03 03", "value": 21}, {"name": "2020-03-03 06", "value": 32}, {"name": "2020-03-03 09", "value": 31}, {"name": "2020-03-03 12", "value": 16}, {"name": "2020-03-03 15", "value": 25}, {"name": "2020-03-03 18", "value": 20}, {"name": "2020-03-03 21", "value": 13}, {"name": "2020-03-04 00", "value": 16}, {"name": "2020-03-04 03", "value": 13}, {"name": "2020-03-04 06", "value": 25}, {"name": "2020-03-04 09", "value": 19}, {"name": "2020-03-04 12", "value": 25}, {"name": "2020-03-04 15", "value": 39}, {"name": "2020-03-04 18", "value": 11}, {"name": "2020-03-04 21", "value": 11}, {"name": "2020-03-05 00", "value": 10}, {"name": "2020-03-05 03", "value": 27}, {"name": "2020-03-05 06", "value": 43}, {"name": "2020-03-05 09", "value": 48}, {"name": "2020-03-05 12", "value": 105}, {"name": "2020-03-05 15", "value": 63}, {"name": "2020-03-05 18", "value": 41}, {"name": "2020-03-05 21", "value": 26}, {"name": "2020-03-06 00", "value": 58}, {"name": "2020-03-06 03", "value": 49}, {"name": "2020-03-06 06", "value": 116}, {"name": "2020-03-06 09", "value": 80}, {"name": "2020-03-06 12", "value": 128}, {"name": "2020-03-06 15", "value": 74}, {"name": "2020-03-06 18", "value": 100}, {"name": "2020-03-06 21", "value": 32}, {"name": "2020-03-07 00", "value": 40}, {"name": "2020-03-07 03", "value": 82}, {"name": "2020-03-07 06", "value": 86}, {"name": "2020-03-07 09", "value": 66}, {"name": "2020-03-07 12", "value": 32}, {"name": "2020-03-07 15", "value": 114}, {"name": "2020-03-07 18", "value": 68}, {"name": "2020-03-07 21", "value": 38}, {"name": "2020-03-08 00", "value": 6}, {"name": "2020-03-08 03", "value": 30}, {"name": "2020-03-08 06", "value": 42}, {"name": "2020-03-08 09", "value": 98}, {"name": "2020-03-08 12", "value": 53}, {"name": "2020-03-08 15", "value": 181}, {"name": "2020-03-08 18", "value": 53}, {"name": "2020-03-08 21", "value": 38}, {"name": "2020-03-09 00", "value": 111}, {"name": "2020-03-09 03", "value": 54}, {"name": "2020-03-09 06", "value": 134}, {"name": "2020-03-09 09", "value": 311}, {"name": "2020-03-09 12", "value": 301}, {"name": "2020-03-09 15", "value": 312}, {"name": "2020-03-09 18", "value": 440}, {"name": "2020-03-09 21", "value": 139}, {"name": "2020-03-10 00", "value": 68}, {"name": "2020-03-10 03", "value": 167}, {"name": "2020-03-10 06", "value": 494}, {"name": "2020-03-10 09", "value": 496}, {"name": "2020-03-10 12", "value": 637}, {"name": "2020-03-10 15", "value": 586}, {"name": "2020-03-10 18", "value": 535}, {"name": "2020-03-10 21", "value": 249}, {"name": "2020-03-11 00", "value": 116}, {"name": "2020-03-11 03", "value": 234}, {"name": "2020-03-11 06", "value": 512}, {"name": "2020-03-11 09", "value": 1385}, {"name": "2020-03-11 12", "value": 1518}, {"name": "2020-03-11 15", "value": 794}, {"name": "2020-03-11 18", "value": 708}, {"name": "2020-03-11 21", "value": 412}, {"name": "2020-03-12 00", "value": 346}, {"name": "2020-03-12 03", "value": 486}, {"name": "2020-03-12 06", "value": 1085}, {"name": "2020-03-12 09", "value": 1560}, {"name": "2020-03-12 12", "value": 1520}, {"name": "2020-03-12 15", "value": 1932}, {"name": "2020-03-12 18", "value": 904}, {"name": "2020-03-12 21", "value": 664}, {"name": "2020-03-13 00", "value": 350}, {"name": "2020-03-13 03", "value": 550}, {"name": "2020-03-13 06", "value": 1742}, {"name": "2020-03-13 09", "value": 3001}, {"name": "2020-03-13 12", "value": 3664}, {"name": "2020-03-13 15", "value": 3717}, {"name": "2020-03-13 18", "value": 2284}, {"name": "2020-03-13 21", "value": 994}, {"name": "2020-03-14 00", "value": 354}, {"name": "2020-03-14 03", "value": 532}, {"name": "2020-03-14 06", "value": 1418}, {"name": "2020-03-14 09", "value": 1758}, {"name": "2020-03-14 12", "value": 893}, {"name": "2020-03-14 15", "value": 742}, {"name": "2020-03-14 18", "value": 676}, {"name": "2020-03-14 21", "value": 377}, {"name": "2020-03-15 00", "value": 142}, {"name": "2020-03-15 03", "value": 1067}, {"name": "2020-03-15 06", "value": 1944}, {"name": "2020-03-15 09", "value": 1243}, {"name": "2020-03-15 12", "value": 1200}, {"name": "2020-03-15 15", "value": 1579}, {"name": "2020-03-15 18", "value": 1249}, {"name": "2020-03-15 21", "value": 998}, {"name": "2020-03-16 00", "value": 685}, {"name": "2020-03-16 03", "value": 880}, {"name": "2020-03-16 06", "value": 1472}, {"name": "2020-03-16 09", "value": 2070}, {"name": "2020-03-16 12", "value": 2224}, {"name": "2020-03-16 15", "value": 1961}, {"name": "2020-03-16 18", "value": 935}, {"name": "2020-03-16 21", "value": 539}, {"name": "2020-03-17 00", "value": 530}, {"name": "2020-03-17 03", "value": 781}, {"name": "2020-03-17 06", "value": 1742}, {"name": "2020-03-17 09", "value": 2368}, {"name": "2020-03-17 12", "value": 1746}, {"name": "2020-03-17 15", "value": 2509}, {"name": "2020-03-17 18", "value": 1434}, {"name": "2020-03-17 21", "value": 1733}, {"name": "2020-03-18 00", "value": 762}, {"name": "2020-03-18 03", "value": 1250}, {"name": "2020-03-18 06", "value": 1990}, {"name": "2020-03-18 09", "value": 1915}, {"name": "2020-03-18 12", "value": 1632}, {"name": "2020-03-18 15", "value": 1925}, {"name": "2020-03-18 18", "value": 1577}, {"name": "2020-03-18 21", "value": 765}, {"name": "2020-03-19 00", "value": 574}, {"name": "2020-03-19 03", "value": 1653}, {"name": "2020-03-19 06", "value": 1425}, {"name": "2020-03-19 09", "value": 1652}, {"name": "2020-03-19 12", "value": 1381}, {"name": "2020-03-19 15", "value": 1234}, {"name": "2020-03-19 18", "value": 774}, {"name": "2020-03-19 21", "value": 419}, {"name": "2020-03-20 00", "value": 303}, {"name": "2020-03-20 03", "value": 565}, {"name": "2020-03-20 06", "value": 969}, {"name": "2020-03-20 09", "value": 1133}, {"name": "2020-03-20 12", "value": 962}, {"name": "2020-03-20 15", "value": 724}, {"name": "2020-03-20 18", "value": 483}, {"name": "2020-03-20 21", "value": 284}, {"name": "2020-03-21 00", "value": 290}, {"name": "2020-03-21 03", "value": 480}, {"name": "2020-03-21 06", "value": 1017}, {"name": "2020-03-21 09", "value": 943}, {"name": "2020-03-21 12", "value": 607}, {"name": "2020-03-21 15", "value": 502}, {"name": "2020-03-21 18", "value": 372}, {"name": "2020-03-21 21", "value": 274}, {"name": "2020-03-22 00", "value": 195}, {"name": "2020-03-22 03", "value": 363}, {"name": "2020-03-22 06", "value": 481}, {"name": "2020-03-22 09", "value": 424}, {"name": "2020-03-22 12", "value": 407}, {"name": "2020-03-22 15", "value": 307}, {"name": "2020-03-22 18", "value": 242}, {"name": "2020-03-22 21", "value": 208}, {"name": "2020-03-23 00", "value": 227}, {"name": "2020-03-23 03", "value": 457}, {"name": "2020-03-23 06", "value": 854}, {"name": "2020-03-23 09", "value": 968}, {"name": "2020-03-23 12", "value": 750}, {"name": "2020-03-23 15", "value": 667}, {"name": "2020-03-23 18", "value": 339}, {"name": "2020-03-23 21", "value": 253}, {"name": "2020-03-24 00", "value": 269}, {"name": "2020-03-24 03", "value": 477}, {"name": "2020-03-24 06", "value": 959}, {"name": "2020-03-24 09", "value": 1259}, {"name": "2020-03-24 12", "value": 1118}, {"name": "2020-03-24 15", "value": 1290}, {"name": "2020-03-24 18", "value": 595}, {"name": "2020-03-24 21", "value": 454}, {"name": "2020-03-25 00", "value": 568}, {"name": "2020-03-25 03", "value": 678}, {"name": "2020-03-25 06", "value": 865}, {"name": "2020-03-25 09", "value": 828}, {"name": "2020-03-25 12", "value": 921}, {"name": "2020-03-25 15", "value": 815}, {"name": "2020-03-25 18", "value": 551}, {"name": "2020-03-25 21", "value": 318}, {"name": "2020-03-26 00", "value": 476}, {"name": "2020-03-26 03", "value": 511}, {"name": "2020-03-26 06", "value": 939}, {"name": "2020-03-26 09", "value": 918}, {"name": "2020-03-26 12", "value": 759}, {"name": "2020-03-26 15", "value": 563}, {"name": "2020-03-26 18", "value": 319}, {"name": "2020-03-26 21", "value": 195}, {"name": "2020-03-27 00", "value": 276}, {"name": "2020-03-27 03", "value": 392}, {"name": "2020-03-27 06", "value": 678}, {"name": "2020-03-27 09", "value": 709}, {"name": "2020-03-27 12", "value": 770}, {"name": "2020-03-27 15", "value": 484}, {"name": "2020-03-27 18", "value": 279}, {"name": "2020-03-27 21", "value": 156}, {"name": "2020-03-28 00", "value": 203}, {"name": "2020-03-28 03", "value": 235}, {"name": "2020-03-28 06", "value": 354}, {"name": "2020-03-28 09", "value": 397}, {"name": "2020-03-28 12", "value": 309}, {"name": "2020-03-28 15", "value": 228}, {"name": "2020-03-28 18", "value": 194}, {"name": "2020-03-28 21", "value": 137}, {"name": "2020-03-29 00", "value": 363}, {"name": "2020-03-29 03", "value": 263}, {"name": "2020-03-29 06", "value": 304}, {"name": "2020-03-29 09", "value": 330}, {"name": "2020-03-29 12", "value": 282}, {"name": "2020-03-29 15", "value": 258}, {"name": "2020-03-29 18", "value": 275}, {"name": "2020-03-29 21", "value": 210}, {"name": "2020-03-30 00", "value": 273}, {"name": "2020-03-30 03", "value": 326}, {"name": "2020-03-30 06", "value": 685}, {"name": "2020-03-30 09", "value": 1007}, {"name": "2020-03-30 12", "value": 856}, {"name": "2020-03-30 15", "value": 608}, {"name": "2020-03-30 18", "value": 501}, {"name": "2020-03-30 21", "value": 309}, {"name": "2020-03-31 00", "value": 298}, {"name": "2020-03-31 03", "value": 417}, {"name": "2020-03-31 06", "value": 608}, {"name": "2020-03-31 09", "value": 595}, {"name": "2020-03-31 12", "value": 634}, {"name": "2020-03-31 15", "value": 392}, {"name": "2020-03-31 18", "value": 284}, {"name": "2020-03-31 21", "value": 224}, {"name": "2020-04-01 00", "value": 274}, {"name": "2020-04-01 03", "value": 377}, {"name": "2020-04-01 06", "value": 559}, {"name": "2020-04-01 09", "value": 644}, {"name": "2020-04-01 12", "value": 570}, {"name": "2020-04-01 15", "value": 403}, {"name": "2020-04-01 18", "value": 295}, {"name": "2020-04-01 21", "value": 163}, {"name": "2020-04-02 00", "value": 191}, {"name": "2020-04-02 03", "value": 381}, {"name": "2020-04-02 06", "value": 597}, {"name": "2020-04-02 09", "value": 690}, {"name": "2020-04-02 12", "value": 4}], "metadata": {"search": "#CovidLibrary OR #CovidLibraries OR (libraries OR library OR librarian OR librarians) AND (covid19 OR CovidCampus OR covid OR covid-19 )", "title": "Libraries and the COVID-19 crisis", "creator": "Peter Binkley"}};
var metadata = data["metadata"];
var values = data.values;
var profile = data.profile;
var opts = profile.opts;
var tformat = opts.format;
var tformatter = d3.time.format(tformat);
var timezone = opts.timezone;
var template = opts.template;
var intervalStr = opts.intervalStr;
var intervalLabel = opts.intervalLabel;

var html = "<strong>" + metadata["title"] + "</strong><br/>Search: " + metadata["search"] + " | Timezone: " + timezone + " | Template: " + template + " | Interval: " + intervalLabel + "<br/>";
html += profile.count + " tweets from " + profile.usercount + " users, including " + profile.retweetcount + " retweets (" + (profile.retweetcount / profile.count * 100).toFixed(2) + "%), ";
html += "and " + profile.geocount + " with geo (" + (profile.geocount / profile.count * 100).toFixed(2) + "%): ";
html += profile.earliest + " to " + profile.latest;
d3.select("#metadata").html(html);

function type(d) { 
    d.name = d3.time.format(tformat).parse(d.name);
}

var vlen = values.length;
for (var i = 0; i < vlen; i++) {
    type(values[i]);
}

var margin = {top: 100, right: 100, bottom: 100, left: 100},
    width = parseInt(d3.select("#chart").style("width")) - margin.left - margin.right,
    height = parseInt(d3.select("#chart").style("height")) - margin.top - margin.bottom;

var svg = d3.select("#chart")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var x = d3.time.scale()
    .domain([
        d3.min(values, function(d) {return d.name}), 
        d3.max(values, function(d) {return d.name})
     ])
    .nice(d3.time.day)
    .range([0, width]);

var y = d3.scale.linear()
    .domain([0, d3.max(values, function(d) { return d.value; })])
    .range([height, 0]);

var timespan = x.invert(width) - x.invert(0) // time span of x, in milliseconds
var interval = opts.interval; // interval of datapoints, in milliseconds
var intervalCount = timespan / interval; // how many intervals in x
var barWidth = width / intervalCount; // width of one interval, in pixels

// x-axis
svg.append("g")
  .attr("class", "x axis")
  .attr("transform", "translate(0," + height + ")")
  .call(d3.svg.axis().scale(x).orient("bottom"))
.append("text")
  .attr("class", "label")
  .attr("x", width)
  .attr("y", 30)
  .style("text-anchor", "end")
  .text("date");
    
// y-axis
svg.append("g")
  .attr("class", "y axis")
  .call(d3.svg.axis().scale(y).orient("left"))
.append("text")
  .attr("class", "label")
  .attr("transform", "rotate(-90)")
  .attr("y", -70)
  .attr("dy", ".71em")
  .style("text-anchor", "end")
  .text("tweets");

var bar = svg.selectAll(".bar")
  .data(values)
.enter().append("g")
  .append("rect")
  .attr("class", "bar")
  .attr("x", function(d) { return x(d.name); })
  .attr("width", barWidth)
  .attr("y", function(d) { return y(d.value); })
  .attr("height", function(d) { return height - y(d.value); })
  .append("svg:title")
  .text(function(d) { return tformatter(d.name) + ": " + d.value + " tweets"; });

</script>
</body>
